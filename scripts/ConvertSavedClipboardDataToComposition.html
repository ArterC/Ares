<!DOCTYPE html>
<html>
<body>


<p>
<textarea id="sourceTextArea" rows="20" cols="150">
[["Land_CncBarrierMedium4_F",[13150.7,15957.8,-3.14713e-005],84.1957,1,0],["Land_CncShelter_F",[13149.7,15962.7,-6.58035e-005],259.898,1,0],["Land_CncBarrier_stripes_F",[13149.7,15962.7,2.43754],84.7398,1,0],["Land_HBarrier_1_F",[13142,15959.6,2.2905],147.102,1,0],["Land_CncBarrierMedium4_F",[13145.9,15964.7,-3.14713e-005],173.157,1,0],["Land_HBarrier_Big_F",[13141.6,15960.9,-0.000167847],263.541,1,0],["Land_CncBarrierMedium4_F",[13147.5,15953.4,-9.91821e-005],170.071,1,0],["Land_CncBarrierMedium_F",[13149.7,15964.7,0.289334],258.604,1,0],["Land_HBarrier_1_F",[13143.5,15953.1,0],355.723,1,0],["Land_HBarrier_1_F",[13142.9,15953,1.4394],355.723,1,0],["Land_HBarrier_1_F",[13142.3,15952.9,0],355.723,1,0],[13146.9,15959.3,0]]
</textarea>
</p>

<p>
<input type="button" value="Process" onClick="myFunction()" />
</p>

<p>
	<textarea id="destinationTextArea" rows="20" cols="150">
	</textarea>
</p>
</body>

<script>
function myFunction()
{
	var sourceText = document.getElementById("sourceTextArea").value.trim();
	// Capture elements of the form:
	//   ["Land_CncBarrierMedium4_F",[13150.7,15957.8,-3.14713e-005],84.1957,1,0]
	var entryRegex = /\["(\w+)",\[([\d\.e\-]+,[\d\.e\-]+,[\d\.e\-]+)\],([\d\.e\-]+),[\d\.e\-]+,[\d\.e\-]+]/g;
	var match;
	
	// Capture elements of the form:
	//   [13146.9,15959.3,0]
	var anchorRegex = /\[([\d\.e\-]+,[\d\.e\-]+,[\d\.e\-]+)\]/g;
	
	// Get the coordinates of the anchor-position (the last match)
	anchorPositionText = "";
	while (match = anchorRegex.exec(sourceText))
	{
		anchorPositionText = match[1];
	}
	if (anchorPositionText != "")
	{
		anchorPosition_x = parseFloat(anchorPositionText.split(',')[0]);
		anchorPosition_y = parseFloat(anchorPositionText.split(',')[1]);
	}

	processedText = "class NEW_COMPOSITION_CLASS_NAME\n{\n\tname=\"Zeus Display Name\";";
	var currentClassNumber = 0;
	while (match = entryRegex.exec(sourceText))
	{
		// For each element we captured we want to make its position relative to the anchor.
		currentObjectPositionTextArray = match[2].split(',');
		currentObjectPosition_x = anchorPosition_x - parseFloat(currentObjectPositionTextArray[0]);
		currentObjectPosition_y = anchorPosition_y - parseFloat(currentObjectPositionTextArray[1]);
		currentObjectPosition_z = parseFloat(currentObjectPositionTextArray[2]);	// The Z is already the correct height above the ground, but we want to trim it if it's small enough.

		// Hackily round digits. Converts back to a number after the .toFixed(...) rounds off the unimportant digits so we don't end up with "x.00000"
		currentObjectPosition_x = parseFloat(currentObjectPosition_x.toFixed(10));
		currentObjectPosition_y = parseFloat(currentObjectPosition_y.toFixed(10));
		currentObjectPosition_z = parseFloat(currentObjectPosition_z.toFixed(10));

		// Flip things 180 degrees because of some weirdness
		currentOrientation = (parseFloat(match[3]) + 180);
		if (currentOrientation > 360) { currentOrientation -= 360; }
		currentOrientation = parseFloat(currentOrientation.toFixed(10));

		// Output the class definition for this object.
		processedText += "\n\tclass Object" + currentClassNumber + " {side=8; vehicle=\"" + match[1] + "\";rank=\"\";position[]={" + currentObjectPosition_x + "," + currentObjectPosition_y + "," + currentObjectPosition_z + "};dir=" + currentOrientation + ";};";
		currentClassNumber++;
	}
	processedText += "\n}";
	
	document.getElementById("destinationTextArea").value = processedText;
}
</script>
</html>